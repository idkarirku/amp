var CanvasImage=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(t){this.context.putImageData(t,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(t,r){return this.getPalette(t,5,r)[0]},ColorThief.prototype.getPalette=function(t,r,n){void 0===r&&(r=10),void 0===n&&(n=10);for(var o,i,e,a,s=new CanvasImage(t),u=s.getImageData().data,h=s.getPixelCount(),c=[],f=0;f<h;f+=n)i=u[(o=4*f)+0],e=u[o+1],a=u[o+2],u[o+3]>=125&&(i>250&&e>250&&a>250||c.push([i,e,a]));var v=MMCQ.quantize(c,r).palette();return s.removeCanvas(),v},!pv)var pv={map:function(t,r){var n={};return r?t.map(function(t,o){return n.index=o,r.call(n,t)}):t.slice()},naturalOrder:function(t,r){return t<r?-1:t>r?1:0},sum:function(t,r){var n={};return t.reduce(r?function(t,o,i){return n.index=i,t+r.call(n,o)}:function(t,r){return t+r},0)},max:function(t,r){return Math.max.apply(null,r?pv.map(t,r):t)}};var MMCQ=function(){var t=5,r=8-t,n=1e3,o=.75;function i(r,n,o){return(r<<2*t)+(n<<t)+o}function e(t){var r=[],n=!1;function o(){r.sort(t),n=!0}return{push:function(t){r.push(t),n=!1},peek:function(t){return n||o(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return n||o(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return n||o(),r}}}function a(t,r,n,o,i,e,a){this.r1=t,this.r2=r,this.g1=n,this.g2=o,this.b1=i,this.b2=e,this.histo=a}function s(){this.vboxes=new e(function(t,r){return pv.naturalOrder(t.vbox.count()*t.vbox.volume(),r.vbox.count()*r.vbox.volume())})}function u(t,r){if(r.count()){var n=r.r2-r.r1+1,o=r.g2-r.g1+1,e=r.b2-r.b1+1,a=pv.max([n,o,e]);if(1==r.count())return[r.copy()];var s,u,h,c,f=0,v=[],p=[];if(a==n)for(s=r.r1;s<=r.r2;s++){for(c=0,u=r.g1;u<=r.g2;u++)for(h=r.b1;h<=r.b2;h++)c+=t[i(s,u,h)]||0;f+=c,v[s]=f}else if(a==o)for(s=r.g1;s<=r.g2;s++){for(c=0,u=r.r1;u<=r.r2;u++)for(h=r.b1;h<=r.b2;h++)c+=t[i(u,s,h)]||0;f+=c,v[s]=f}else for(s=r.b1;s<=r.b2;s++){for(c=0,u=r.r1;u<=r.r2;u++)for(h=r.g1;h<=r.g2;h++)c+=t[i(u,h,s)]||0;f+=c,v[s]=f}return v.forEach(function(t,r){p[r]=f-t}),g(a==n?"r":a==o?"g":"b")}function g(t){var n,o,i,e,a,u=t+"1",h=t+"2",c=0;for(s=r[u];s<=r[h];s++)if(v[s]>f/2){for(i=r.copy(),e=r.copy(),a=(n=s-r[u])<=(o=r[h]-s)?Math.min(r[h]-1,~~(s+o/2)):Math.max(r[u],~~(s-1-n/2));!v[a];)a++;for(c=p[a];!c&&v[a-1];)c=p[--a];return i[h]=a,e[u]=i[h]+1,[i,e]}}}return a.prototype={volume:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(t){var r=this.histo;if(!this._count_set||t){var n,o,e,a=0;for(n=this.r1;n<=this.r2;n++)for(o=this.g1;o<=this.g2;o++)for(e=this.b1;e<=this.b2;e++)index=i(n,o,e),a+=r[index]||0;this._count=a,this._count_set=!0}return this._count},copy:function(){return new a(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(r){var n=this.histo;if(!this._avg||r){var o,e,a,s,u=0,h=1<<8-t,c=0,f=0,v=0;for(e=this.r1;e<=this.r2;e++)for(a=this.g1;a<=this.g2;a++)for(s=this.b1;s<=this.b2;s++)u+=o=n[i(e,a,s)]||0,c+=o*(e+.5)*h,f+=o*(a+.5)*h,v+=o*(s+.5)*h;this._avg=u?[~~(c/u),~~(f/u),~~(v/u)]:[~~(h*(this.r1+this.r2+1)/2),~~(h*(this.g1+this.g2+1)/2),~~(h*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(t){var n=t[0]>>r;return gval=t[1]>>r,bval=t[2]>>r,n>=this.r1&&n<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},s.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(t))return r.peek(n).color;return this.nearest(t)},nearest:function(t){for(var r,n,o,i=this.vboxes,e=0;e<i.size();e++)((n=Math.sqrt(Math.pow(t[0]-i.peek(e).color[0],2)+Math.pow(t[1]-i.peek(e).color[1],2)+Math.pow(t[2]-i.peek(e).color[2],2)))<r||void 0===r)&&(r=n,o=i.peek(e).color);return o},forcebw:function(){var t=this.vboxes;t.sort(function(t,r){return pv.naturalOrder(pv.sum(t.color),pv.sum(r.color))});var r=t[0].color;r[0]<5&&r[1]<5&&r[2]<5&&(t[0].color=[0,0,0]);var n=t.length-1,o=t[n].color;o[0]>251&&o[1]>251&&o[2]>251&&(t[n].color=[255,255,255])}},{quantize:function(h,c){if(!h.length||c<2||c>256)return!1;var f=function(n){var o,e,a,s,u=new Array(1<<3*t);return n.forEach(function(t){e=t[0]>>r,a=t[1]>>r,s=t[2]>>r,o=i(e,a,s),u[o]=(u[o]||0)+1}),u}(h);f.forEach(function(){});var v=function(t,n){var o,i,e,s=1e6,u=0,h=1e6,c=0,f=1e6,v=0;return t.forEach(function(t){o=t[0]>>r,i=t[1]>>r,e=t[2]>>r,o<s?s=o:o>u&&(u=o),i<h?h=i:i>c&&(c=i),e<f?f=e:e>v&&(v=e)}),new a(s,u,h,c,f,v,n)}(h,f),p=new e(function(t,r){return pv.naturalOrder(t.count(),r.count())});function g(t,r){for(var o,i=1,e=0;e<n;)if((o=t.pop()).count()){var a=u(f,o),s=a[0],h=a[1];if(!s)return;if(t.push(s),h&&(t.push(h),i++),i>=r)return;if(e++>n)return}else t.push(o),e++}p.push(v),g(p,o*c);for(var l=new e(function(t,r){return pv.naturalOrder(t.count()*t.volume(),r.count()*r.volume())});p.size();)l.push(p.pop());g(l,c-l.size());for(var b=new s;l.size();)b.push(l.pop());return b}}}();
